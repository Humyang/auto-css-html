webpackJsonp([2],{R4qy:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mjRP");Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t};var s={name:"App",data:function(){return{currentTime:"",isCollapse:!0,showAddTask:!1,dialog_selectTime:0,selectedTime:[],selectedTimeStmap:[],tableData:[],form:{time:"",task:""},token:"",action:"",query_options:0,options:[{value:0,label:"全部"},{value:1,label:"开始时间"},{value:2,label:"创建时间"}],pickerOptions2:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]}}},filters:{timePass:function(t){if(!t)return"";var e=new Date(t),a=e.getFullYear()+"",i=e.getMonth()+1+"",s=i<10?"0"+i:i,n=e.getDate()+"",o=n<10?"0"+n:n,r=e.getHours()+"",l=r<10?"0"+r:r,m=e.getMinutes()+"",d=m<10?"0"+m:m,c=e.getSeconds()+"";return a+"."+s+"."+o+" "+l+":"+d+":"+(c<10?"0"+c:c)}},methods:{tableRowClassName:function(t){t.row;var e=t.rowIndex;return this.tableData[e].isPaused?"paused":this.tableData[e].remainTime>0?"staring":0==this.tableData[e].remainTime?"ended":""},refreshRemainTime:function(){var t=(new Date).getTime();this.tableData=this.tableData.map(function(e){var a=e.endAt;if(e.isPaused)return e.status="暂停中",e.endTime=new Date(a).Format("yyyy-MM-dd hh:mm:ss"),e;if(!e.startAtTimestmap)return e.status="未开始",e;e.status="进行中";var i=Math.round((a-t)/1e3/60);return e.endTime=new Date(a).Format("yyyy-MM-dd hh:mm:ss"),(isNaN(i)||i<=0)&&(e.status="已结束",i=0),e.remainTime=i,e})},actionDropdown:function(t){var e=this;switch(t.type){case"startTask":this.api.plan.startTask({id:t.id,remainTime:t.remainTime}).then(function(){e.getPlanList()});break;case"stopTask":t.isPaused?this.api.plan.resumeTask({id:t.id,remainTime:t.remainTime}).then(function(){e.getPlanList()}):this.api.plan.stopTask({id:t.id,remainTime:t.remainTime}).then(function(){e.getPlanList()});break;case"delTask":this.api.plan.delTask({id:t.id}).then(function(){e.getPlanList()})}},actionQuery:function(){this.selectedTime=[this.getDayStart(this.selectedTime[0]),this.getDayEnd(this.selectedTime[1])],this.getPlanList()},dialog_Submit:function(){this.$refs.elform.$el.submit()},eventPickChange:function(t){var e=new Date(t).getTime(),a=(new Date).getTime();console.log(e-a);var i=(e-a)/1e3/60;this.dialog_selectTime=Math.round(i,2)},actionAddTask:function(){this.showAddTask=!0},handleOpen:function(t,e){console.log(t,e)},handleClose:function(t,e){console.log(t,e)},getPlanList:function(){var t=this;this.api.plan.getPlanList({date_start:this.selectedTime[0],date_end:this.selectedTime[1],query_options:this.query_options}).then(function(e){var a=e.data,i=(a=a.sort(function(t,e,a){var i=new Date(t.startAt).getTime(),s=new Date(e.startAt).getTime();return isNaN(i)&&(i=0),isNaN(s)&&(s=0),console.log(i,s),i-s})).map(function(t){return t.startAt?(t.startAtTimestmap=t.startAt,t.startAt=new Date(t.startAt).Format("yyyy-MM-dd hh:mm:ss"),t.stopAt=new Date(t.stopAt).Format("yyyy-MM-dd hh:mm:ss"),t):t});t.tableData=i,t.refreshRemainTime()})},getDayStart:function(t){var e=new Date(t).Format("yyyy-MM-dd");return new Date(e+" 00:00:00").getTime()},getDayEnd:function(t){var e=new Date(t).Format("yyyy-MM-dd");return new Date(e+" 23:59:59").getTime()}},mounted:function(){var t=this;setInterval(function(){t.currentTime=new Date},1e3),setInterval(function(){t.refreshRemainTime()},1e3),this.token=this.$store.state.token,this.action=i.a+":"+i.b+"/add_plan";var e=new Date;this.selectedTime=[this.getDayStart(e),this.getDayEnd(e)],this.getPlanList()}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"plan"},[a("el-container",[a("el-header",{staticClass:"header",attrs:{height:"80px;"}},[a("p",[t._v("当前时间:"+t._s(t._f("timePass")(t.currentTime)))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showAddTask=!0}}},[t._v("添加新任务")]),t._v(" "),a("el-form",{ref:"elform",attrs:{model:t.form,action:t.action,method:"post"}},[a("el-container",{staticClass:"query-wrap"},[a("p",[t._v("筛选条件")]),t._v(" "),a("el-select",{attrs:{placeholder:"全部"},model:{value:t.query_options,callback:function(e){t.query_options=e},expression:"query_options"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),a("div",{staticClass:"block"},[a("span",{staticClass:"demonstration"},[t._v("筛选日期")]),t._v(" "),a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.pickerOptions2},model:{value:t.selectedTime,callback:function(e){t.selectedTime=e},expression:"selectedTime"}})],1),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.actionQuery}},[t._v("查询")])],1)],1)],1),t._v(" "),a("el-main",[a("el-table",{staticStyle:{width:"100%"},attrs:{align:"center",data:t.tableData,"row-class-name":t.tableRowClassName}},[a("el-table-column",{attrs:{prop:"status",label:"状态",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"time",label:"投入时间（分）",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"startAt",label:"开始时间",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"stopAt",label:"暂停时间",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remainTime",label:"剩余时间（分)"}}),t._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"预计结束时间"}}),t._v(" "),a("el-table-column",{attrs:{prop:"task",label:"任务内容"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-dropdown",{on:{command:t.actionDropdown}},[a("span",{staticClass:"el-dropdown-link"},[t._v("\n                编辑\n                "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},["未开始"==e.row.status?a("el-dropdown-item",{attrs:{command:{type:"startTask",id:e.row.planid,remainTime:e.row.time}}},[t._v("开始任务")]):t._e(),t._v(" "),"进行中"==e.row.status||"暂停中"==e.row.status?a("el-dropdown-item",{attrs:{command:{type:"stopTask",id:e.row.planid,remainTime:e.row.remainTime,isPaused:e.row.isPaused}}},[t._v(t._s(e.row.isPaused?"继续任务":"停止任务"))]):t._e(),t._v(" "),"未开始"!=e.row.status?a("el-dropdown-item",{attrs:{command:{type:"startTask",id:e.row.planid,remainTime:e.row.time}}},[t._v("重置时间")]):t._e(),t._v(" "),"进行中"!=e.row.status?a("el-dropdown-item",{attrs:{command:{type:"delTask",id:e.row.planid}}},[t._v("删除")]):t._e()],1)],1)]}}])})],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"添加任务",visible:t.showAddTask},on:{"update:visible":function(e){t.showAddTask=e}}},[a("el-form",{ref:"elform",attrs:{model:t.form,action:t.action,method:"post"}},[a("input",{attrs:{type:"hidden",name:"token"},domProps:{value:t.token}}),t._v(" "),a("el-form-item",{staticClass:"dialog-content",attrs:{label:"投入时间"}},[a("el-input-number",{attrs:{step:15},model:{value:t.dialog_selectTime,callback:function(e){t.dialog_selectTime=e},expression:"dialog_selectTime"}}),t._v("\n        （单位：分钟）\n        "),a("input",{attrs:{type:"hidden",name:"time"},domProps:{value:t.dialog_selectTime}})],1),t._v(" "),a("el-form-item",{staticClass:"dialog-content",attrs:{label:"任务内容"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.task,expression:"form.task"}],attrs:{name:"task",id:"",cols:"30",rows:"10"},domProps:{value:t.form.task},on:{input:function(e){e.target.composing||t.$set(t.form,"task",e.target.value)}}})]),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.showAddTask=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.dialog_Submit}},[t._v("提 交")])],1)],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(s,n,!1,function(t){a("tczL")},null,null);e.default=o.exports},tczL:function(t,e){}});
//# sourceMappingURL=2.f3231139f1ffc328b96a.js.map